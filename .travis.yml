matrix:
  include:
    - language: node_js
      node_js:
        - 14
      cache:
        directories:
          - node_modules
      script: 
        - yarn test
        - yarn lint

    - language: android
      os: linux
      jdk: oraclejdk8
      sudo: required
      cache:
        directories:
          - $HOME/.gradle/caches/
          - $HOME/.gradle/wrapper/
          - $HOME/.android/build-cache
      android:
        components:
          - platform-tools
          - tools
          - build-tools-29.0.2
          - android-29
      before_install:
        - cd android/app
        - openssl aes-256-cbc -K $encrypted_cec398169802_key -iv $encrypted_cec398169802_iv -in my-release-key.keystore.enc -out my-release-key.keystore -d
        - cd ...
      script:
        - cd android && ./gradlew assembleDebug && ..
      before_deploy:
        - export APP_VERSION=$(./gradlew :app:printVersionName)
        - export APP_CHANGELOG=$(cat app/src/main/play/release-notes/en-US/default.txt)
      deploy:
        - provider: releases
          api_key: "$GITHUB_TOKEN"
          file: app/build/outputs/apk/release/*
          file_glob: true
          skip_cleanup: true
          overwrite: true
          name: "$APP_VERSION"
          tag_name: "$APP_VERSION"
          body: "$APP_CHANGELOG"
          on:
            branch: master